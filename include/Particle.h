#ifndef PARTICLE
#define PARTICLE

#include <ngl/Vec3.h>
#include <ngl/Mat3.h>

//------------------------------------------------------------------------------------------------------------------------------------------------------
/// @file Particle.h
/// @brief Particle structure containing data specific to one particle
/// @author Ina M. Sorensen
/// @version 1.0
/// @date 25.06.16
///
/// @todo
//------------------------------------------------------------------------------------------------------------------------------------------------------

enum Phase
{
  Solid,
  Liquid
};

class Emitter;

class Particle
{
public:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle constructor
  //----------------------------------------------------------------------------------------------------------------------
  Particle(ngl::Vec3 _position, float _mass, float _temperature, bool _solid, float _latentHeat, Emitter* _emitter);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle destructor
  //----------------------------------------------------------------------------------------------------------------------
  ~Particle();

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Get particle position
  //----------------------------------------------------------------------------------------------------------------------
  inline ngl::Vec3 getPosition(){return m_position;}

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Update particle. Calls to update velocity, position, temperature and deformation gradient
  /// @param [in] _dt: Time step
  //----------------------------------------------------------------------------------------------------------------------
  void update(float _dt);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Render particle
  //----------------------------------------------------------------------------------------------------------------------
  void render();

private:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle position
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Vec3 m_position;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle velocity
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Vec3 m_velocity;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle mass
  //----------------------------------------------------------------------------------------------------------------------
  float m_mass;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Initial volume of particle. Used to calculate density
  //----------------------------------------------------------------------------------------------------------------------
  float m_initalVolume;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Elastic deformation gradient, F_E
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Mat3 m_deformationElastic;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Plastic deformation gradient, F_P;
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Mat3 m_deformationPlastic;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Actual lame constant mu, taking into account hardening
  //----------------------------------------------------------------------------------------------------------------------
  float m_lameMu;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Actual lame constant lambda, taking into account hardening
  //----------------------------------------------------------------------------------------------------------------------
  float m_lameLambda;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle temperature
  //----------------------------------------------------------------------------------------------------------------------
  float m_temperature;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Transition heat of particle. Empty (0.0) if solid, full (equal to latent heat) if fluid. Transitioning if
  /// inbetween.
  //----------------------------------------------------------------------------------------------------------------------
  float m_transitionHeat;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Says if particle is solid or liquid.
  //----------------------------------------------------------------------------------------------------------------------
  Phase m_phase;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Emitter that particle belongs to
  //----------------------------------------------------------------------------------------------------------------------
  const Emitter* m_emitter;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Updates velocity
  //----------------------------------------------------------------------------------------------------------------------
  void updateVelocity();
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Updates position
  //----------------------------------------------------------------------------------------------------------------------
  void updatePosition();
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Updates temperature. Checks whether phase change is happening
  //----------------------------------------------------------------------------------------------------------------------
  void updateTemperature();
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Updates deformation gradient and verifies elastic/plastic contribution
  //----------------------------------------------------------------------------------------------------------------------
  void updateDeformationGradient();

};


#endif // PARTICLE

